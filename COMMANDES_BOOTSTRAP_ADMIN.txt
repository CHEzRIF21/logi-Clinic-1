===========================================
ðŸš€ COMMANDES RAPIDES - Bootstrap Clinic Admin
===========================================

ðŸ“‹ Ã‰TAPE 1 : DÃ©ployer la fonction
----------------------------------
# Obtenir le token Supabase (si pas dÃ©jÃ  fait)
# Allez sur: https://supabase.com/dashboard/account/tokens

$env:SUPABASE_ACCESS_TOKEN='sbp_5da8e97668cd218ba3095c6f1321603303f5aee3VOTRE_TOKEN_SUPABASE'
cd "c:\Users\Mustafa\Desktop\logi Clinic 1"
npx supabase link --project-ref bnfgemmlokvetmohiqch
npx supabase functions deploy bootstrap-clinic-admin-auth

===========================================
ðŸ“‹ Ã‰TAPE 2 : Obtenir le token SUPER_ADMIN
===========================================
Option A - Via l'application frontend:
1. Connectez-vous avec babocher21@gmail.com
2. Console navigateur (F12) â†’ Application â†’ Local Storage
3. Ou exÃ©cutez dans la console:
   const { data: { session } } = await supabase.auth.getSession();
   console.log(session?.access_token);

Option B - Via PowerShell (si vous avez le mot de passe):
$body = @{
    email = "babocher21@gmail.com"
    password = "BABOni21"
} | ConvertTo-Json

$response = Invoke-RestMethod -Uri "https://bnfgemmlokvetmohiqch.supabase.co/auth/v1/token?grant_type=password" `
    -Method Post `
    -Headers @{
        "Content-Type" = "application/json"
        "apikey" = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJuZmdlbW1sb2t2ZXRtb2hpcWNoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NzI1MTksImV4cCI6MjA3ODQ0ODUxOX0.53UOzq6eeZRqG8dk6lTGMVZsoK4aiZGU5I1q-JIUMd8"
    } `
    -Body $body

$superAdminToken = $response.access_token
Write-Host "Token: $superAdminToken"

===========================================
ðŸ“‹ Ã‰TAPE 3 : Appeler la fonction
===========================================

Option A - Via le script PowerShell (RECOMMANDÃ‰):
.\bootstrap-clinic-admin.ps1 -SuperAdminToken "eyJhbGciOiJIUzI1NiIsImtpZCI6InJ1SlJDM3F4MlpPbzlIelUiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2JuZmdlbW1sb2t2ZXRtb2hpcWNoLnN1cGFiYXNlLmNvL2F1dGgvdjEiLCJzdWIiOiI2NGZmOWEwNi1iYjRjLTQzOWYtODQxZi1hMDYyNzgyNTEzNzUiLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzY2NTY3OTA3LCJpYXQiOjE3NjY1NjQzMDcsImVtYWlsIjoiYmFib2NoZXIyMUBnbWFpbC5jb20iLCJwaG9uZSI6IiIsImFwcF9tZXRhZGF0YSI6eyJwcm92aWRlciI6ImVtYWlsIiwicHJvdmlkZXJzIjpbImVtYWlsIl19LCJ1c2VyX21ldGFkYXRhIjp7ImVtYWlsX3ZlcmlmaWVkIjp0cnVlfSwicm9sZSI6ImF1dGhlbnRpY2F0ZWQiLCJhYWwiOiJhYWwxIiwiYW1yIjpbeyJtZXRob2QiOiJwYXNzd29yZCIsInRpbWVzdGFtcCI6MTc2NjU2NDMwN31dLCJzZXNzaW9uX2lkIjoiNDhmOTU4ZjktMzQwZC00NWMyLThlYzMtOWJjMTg0NGFkZmFkIiwiaXNfYW5vbnltb3VzIjpmYWxzZX0.FJs9_5bCdJvNsRdy17qNtKDgzVNTHW1t6xhpD-JSjgY"

Option B - Via PowerShell manuel:
$superAdminToken = "eyJhbGciOiJIUzI1NiIsImtpZCI6InJ1SlJDM3F4MlpPbzlIelUiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2JuZmdlbW1sb2t2ZXRtb2hpcWNoLnN1cGFiYXNlLmNvL2F1dGgvdjEiLCJzdWIiOiI2NGZmOWEwNi1iYjRjLTQzOWYtODQxZi1hMDYyNzgyNTEzNzUiLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzY2NTY3OTA3LCJpYXQiOjE3NjY1NjQzMDcsImVtYWlsIjoiYmFib2NoZXIyMUBnbWFpbC5jb20iLCJwaG9uZSI6IiIsImFwcF9tZXRhZGF0YSI6eyJwcm92aWRlciI6ImVtYWlsIiwicHJvdmlkZXJzIjpbImVtYWlsIl19LCJ1c2VyX21ldGFkYXRhIjp7ImVtYWlsX3ZlcmlmaWVkIjp0cnVlfSwicm9sZSI6ImF1dGhlbnRpY2F0ZWQiLCJhYWwiOiJhYWwxIiwiYW1yIjpbeyJtZXRob2QiOiJwYXNzd29yZCIsInRpbWVzdGFtcCI6MTc2NjU2NDMwN31dLCJzZXNzaW9uX2lkIjoiNDhmOTU4ZjktMzQwZC00NWMyLThlYzMtOWJjMTg0NGFkZmFkIiwiaXNfYW5vbnltb3VzIjpmYWxzZX0.FJs9_5bCdJvNsRdy17qNtKDgzVNTHW1t6xhpD-JSjgY"
$body = @{
    clinicCode = "CAMPUS-001"
    adminEmail = "bagarayannick1@gmail.com"
    adminPassword = "TempClinic2024!"
} | ConvertTo-Json

Invoke-RestMethod -Uri "https://bnfgemmlokvetmohiqch.supabase.co/functions/v1/bootstrap-clinic-admin-auth" `
    -Method Post `
    -Headers @{
        "Authorization" = "Bearer $eyJhbGciOiJIUzI1NiIsImtpZCI6InJ1SlJDM3F4MlpPbzlIelUiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2JuZmdlbW1sb2t2ZXRtb2hpcWNoLnN1cGFiYXNlLmNvL2F1dGgvdjEiLCJzdWIiOiI2NGZmOWEwNi1iYjRjLTQzOWYtODQxZi1hMDYyNzgyNTEzNzUiLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzY2NTY3OTA3LCJpYXQiOjE3NjY1NjQzMDcsImVtYWlsIjoiYmFib2NoZXIyMUBnbWFpbC5jb20iLCJwaG9uZSI6IiIsImFwcF9tZXRhZGF0YSI6eyJwcm92aWRlciI6ImVtYWlsIiwicHJvdmlkZXJzIjpbImVtYWlsIl19LCJ1c2VyX21ldGFkYXRhIjp7ImVtYWlsX3ZlcmlmaWVkIjp0cnVlfSwicm9sZSI6ImF1dGhlbnRpY2F0ZWQiLCJhYWwiOiJhYWwxIiwiYW1yIjpbeyJtZXRob2QiOiJwYXNzd29yZCIsInRpbWVzdGFtcCI6MTc2NjU2NDMwN31dLCJzZXNzaW9uX2lkIjoiNDhmOTU4ZjktMzQwZC00NWMyLThlYzMtOWJjMTg0NGFkZmFkIiwiaXNfYW5vbnltb3VzIjpmYWxzZX0.FJs9_5bCdJvNsRdy17qNtKDgzVNTHW1t6xhpD-JSjgY"
        "Content-Type" = "application/json"
        "apikey" = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJuZmdlbW1sb2t2ZXRtb2hpcWNoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NzI1MTksImV4cCI6MjA3ODQ0ODUxOX0.53UOzq6eeZRqG8dk6lTGMVZsoK4aiZGU5I1q-JIUMd8"
    } `
    -Body $body

Option C - Via curl:
curl -X POST "https://bnfgemmlokvetmohiqch.supabase.co/functions/v1/bootstrap-clinic-admin-auth" \
  -H "Authorization: Bearer VOTRE_TOKEN_SUPER_ADMIN" \
  -H "Content-Type: application/json" \
  -H "apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJuZmdlbW1sb2t2ZXRtb2hpcWNoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NzI1MTksImV4cCI6MjA3ODQ0ODUxOX0.53UOzq6eeZRqG8dk6lTGMVZsoK4aiZGU5I1q-JIUMd8" \
  -d '{
    "clinicCode": "CAMPUS-001",
    "adminEmail": "bagarayannick1@gmail.com",
    "adminPassword": "TempClinic2024!"
  }'

===========================================
âœ… VÃ‰RIFICATION
===========================================
# VÃ©rifier dans Supabase Dashboard â†’ SQL Editor:
SELECT 
  u.email,
  u.role,
  u.status,
  u.auth_user_id,
  c.code as clinic_code
FROM users u
LEFT JOIN clinics c ON u.clinic_id = c.id
WHERE u.email = 'bagarayannick1@gmail.com';

# RÃ©sultat attendu:
# - auth_user_id n'est plus NULL
# - clinic_code = 'CAMPUS-001'

===========================================
ðŸ“– GUIDE COMPLET
===========================================
Consultez GUIDE_BOOTSTRAP_CLINIC_ADMIN.md pour plus de dÃ©tails

